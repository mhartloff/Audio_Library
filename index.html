<!DOCTYPE html>
<HEAD>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Audio Test</title>
</HEAD>
<BODY onload="onLoad();">

   <script src="JavaScript/Common/Utils.js"></script>
   <script src="JavaScript/Common/DeviceMotion.js"></script>

	<script src="JavaScript/Canvas2D.js"></script>
   <script src="JavaScript/WebAudio.js"></script>
   <script src="JavaScript/Sound.js"></script>
   <script src="JavaScript/SpatialSound.js"></script>
   <script src="JavaScript/PannerSound.js"></script>
	<script src="JavaScript/TestSound.js"></script>
   <script src="JavaScript/Scene.js"></script>
   <script src="JavaScript/SceneObject.js"></script>
   <script src="JavaScript/EarInfo.js"></script>
	
	<script>
		var waveCanvas = null;
		
		var scene = null;
		var bird = null;
		var aceOfBass = null;
		var testSound = null;

		function onLoad() {

		   DeviceMotion.init();
		   WebAudio.init();
			WebAudio.loadSoundSource("Sounds/Owl.wav", "owl");
			WebAudio.loadSoundSource("Sounds/Bird1.wav", "bird1");
			WebAudio.loadSoundSource("Sounds/Bird2.wav", "bird2");
			WebAudio.loadSoundSource("Sounds/Sword.wav", "sword");
			WebAudio.loadSoundSource("Sounds/beautiful_life.wav", "aceOfBass");
			WebAudio.loadSoundSource("Sounds/Scream.wav", "Scream");
			WebAudio.loadSoundSource("Sounds/1000htz.wav", "1000htz");

			this.scene = new Scene();
			this.scene.setCanvas(document.getElementById("scene_canvas"));
		
			this.bird = new SceneObject(WebAudio.getSoundSource("bird1"),
         {
            position: new Vector(3, 0, 0),
            soundType: SceneObject.SoundTypeEnum.panner,
            alias: 'Birdy'
         });

			this.aceOfBass = new SceneObject(WebAudio.getSoundSource("aceOfBass"),
         {
            position: new Vector(-3, 0, 0),
            soundType: SceneObject.SoundTypeEnum.panner,
            alias: 'Ace of Bass'
         });

			this.testSound = new SceneObject(WebAudio.getSoundSource("1000htz"),
			{
				position: new Vector(0, 0, -3),
				soundType: SceneObject.SoundTypeEnum.test,
				soundOptions: { outputCanvas: document.getElementById("analysis_canvas_1"),
									mod: false },
				alias: 'Test'
			});

			this.scene.addObject(this.bird);
			this.scene.addObject(this.aceOfBass);
			this.scene.addObject(this.testSound);
		}
               
		
      // Playing with local storage here...
		//localStorage.setItem("lastPlayed", alias);
      //var lastPlayed = localStorage.getItem("lastPlayed");
      //document.getElementById("lastPlayed").innerText = lastPlayed ? lastPlayed : "none";

		
	</script>
    
	<h3>Web Audio API Demo</h3>

   <h5>Motion</h5>
   <div id="deviceMotionOutput"></div>
	<table>
		<tr><td>Volume:</td>
			<td><input type="range" min="0" max="1" step="0.1" value="1" oninput="getElementById('volOutput').innerText = value; WebAudio.setGain(value);" /></td>
			<td><span id="volOutput">1</span></td>
		</tr>
      <tr><td>HeadWidth:</td>
         <td><input type="range" min="0" max="20" step="1" value="8" oninput="getElementById('headOutput').innerText = value; EarInfo.earDistance = value / 39.3; scene.updateEarInfo();" /></td>
			<td><span id="headOutput">8</span></td>
		</tr>
      <tr><td>Gain Change:</td>
         <td><input type="range" min="0" max="1.0" step=".05" value="0.4" oninput="getElementById('gainOutput').innerText = value; EarInfo.attenAmount = 0.4; scene.updateEarInfo();" /></td>
			<td><span id="gainOutput">0.4</span></td>
		</tr>
	</table>
	<br>
    
   <input type="button" value="BIRDY" onclick="bird.play();" />
   <input type="button" value="ACE OF BASS" onclick="aceOfBass.play();" />
   <input type="button" value="TEST" onclick="testSound.play(); " /><br /><br>
	   
   <!--<input type="button" value="OWL" onclick="playSound('owl');" />
   
	<input type="button" value="BIRD 2" onclick="bird.play();" />
	<input type="button" value="SWORD" onclick="playSound('sword');" />
	<input type="button" value="Scream" onclick="playSound('Scream');" /><br /> 
   Repeat: <input type="checkbox" id="repeatSound" /><br>  -->
   <input type="button" value="Stop All" onclick="scene.stopAllSounds();" /><br /><br>
   
   <h4>Sound Info </h4><div id="sound_info"></div>
	<canvas id="analysis_canvas_1" width="512" height="500" tabindex="1"></canvas><br>
		
	Position Info (+Y comes out of the screen) <br>
	<canvas id="scene_canvas" width="450" height="450"></canvas>
		
   Test: <span id="testOutput"></span><br>
   Last Played: <span id="lastPlayed"></span><br><br>
</BODY>

